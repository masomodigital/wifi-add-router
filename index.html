<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add Router</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #eef2f7, #dbe4f0);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }

  .container {
    background: #fff;
    padding: 40px 30px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    text-align: center;
    width: 100%;
    max-width: 400px;
  }

  h2 {
    color: #333;
    margin-bottom: 25px;
  }

  select, input, button {
    width: 100%;
    padding: 12px 15px;
    margin: 8px 0;
    border-radius: 8px;
    font-size: 1rem;
    box-sizing: border-box;
  }

  select, input {
    border: 1px solid #ccc;
    transition: border 0.3s;
  }

  select:focus, input:focus {
    border-color: #2c7be5;
    outline: none;
  }

  button {
    background-color: #2c7be5;
    color: #fff;
    border: none;
    cursor: pointer;
    transition: background 0.3s;
  }

  button:hover {
    background-color: #1a5bb8;
  }

  #result {
    margin-top: 20px;
    font-weight: bold;
    white-space: pre-line;
  }

  .green {
    color: green;
    font-weight: bold;
  }
</style>
</head>
<body>
<div class="container">
  <h2>Add Router</h2>
  <form id="routerForm">
    <select id="sellerSelect" required>
      <option value="">Loading sellers...</option>
    </select>
    <input type="text" id="routerIP" placeholder="Router IP" required>
    <input type="text" id="username" placeholder="Username" required>
    <input type="text" id="password" placeholder="Password" required>
    <input type="text" id="hotspotName" placeholder="Hotspot Name" required>
    <input type="text" id="notes" placeholder="Notes">
    <button type="submit">Save Router</button>
  </form>
  <div id="result"></div>
</div>

<script>
  const WORKER_URL = "https://cold-block-5e3a.dmaundu02.workers.dev/"; // replace with your Cloudflare Worker

  const sellerSelect = document.getElementById('sellerSelect');
  const resultDiv = document.getElementById('result');

  // Fetch function
  async function fetchFromWorker(action, payload={}) {
    try {
      const res = await fetch(WORKER_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action, ...payload })
      });
      return await res.json();
    } catch (err) {
      return { success: false, message: err.message };
    }
  }

  // Load sellers
  async function loadSellers() {
    resultDiv.textContent = "⏳ Loading sellers...";
    resultDiv.className = "green";
    const sellers = await fetchFromWorker("getSellers");
    if (!sellers || sellers.length === 0) {
      resultDiv.textContent = "❌ No sellers found";
      resultDiv.className = "";
      return;
    }

    sellerSelect.innerHTML = '<option value="">-- Select Seller --</option>';
    sellers.forEach(s => {
      const opt = document.createElement('option');
      opt.value = s.id;
      opt.textContent = s.name + ' (' + s.id + ')';
      sellerSelect.appendChild(opt);
    });

    resultDiv.textContent = "✅ Sellers loaded";
    resultDiv.className = "green";
  }

  loadSellers();

  // Handle form submission
  document.getElementById('routerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const data = {
      sellerId: sellerSelect.value,
      routerIP: document.getElementById('routerIP').value.trim(),
      username: document.getElementById('username').value.trim(),
      password: document.getElementById('password').value.trim(),
      hotspotName: document.getElementById('hotspotName').value.trim(),
      notes: document.getElementById('notes').value.trim()
    };

    if (!data.sellerId) {
      resultDiv.textContent = '❌ Please select a seller';
      resultDiv.className = "";
      return;
    }

    resultDiv.textContent = '⏳ Saving router...';
    resultDiv.className = "green";

    const res = await fetchFromWorker("addRouter", data);
    if (res.success) {
      resultDiv.textContent = '✅ Router saved! ID: ' + res.routerId;
      resultDiv.className = "green";
      document.getElementById('routerForm').reset();
    } else {
      resultDiv.textContent = '❌ ' + res.message;
      resultDiv.className = "";
    }
  });
</script>
</body>
</html>
